name: Test Release Notification

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v1.3.0)'
        required: true
        default: 'v1.3.0'
      release_name:
        description: 'Release name'
        required: true
        default: 'Asana v3 API Migration'
      release_body:
        description: 'Release notes/body'
        required: true
        default: |
          ## Major Changes
          - Migrated from Asana v1 to v3 API
          - Added mark-asana-task-complete action
          - Updated all API calls for v3 compatibility
          - 43 tests passing
          
          ## Breaking Changes
          - None for end users - all existing workflows continue to work
          
          ## New Features
          - New `mark-asana-task-complete` action for individual task completion
      release_url:
        description: 'Release URL'
        required: true
        default: 'https://github.com/duckduckgo/native-github-asana-sync/releases/tag/v1.3.0'

jobs:
  test-notify-teams:
    runs-on: ubuntu-latest
    name: Test Asana Task Creation for Release Notification
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set release information
        id: release-info
        run: |
          echo "version=${{ github.event.inputs.version }}" >> $GITHUB_OUTPUT
          echo "release_url=${{ github.event.inputs.release_url }}" >> $GITHUB_OUTPUT
          echo "release_name=${{ github.event.inputs.release_name }}" >> $GITHUB_OUTPUT
          
      - name: Create task description
        id: task-description
        run: |
          DESCRIPTION="ðŸš€ **New Asana <> Github Integration Release Available**

          **Version:** ${{ steps.release-info.outputs.version }}
          **Release:** ${{ steps.release-info.outputs.release_name }}
          
          **What's New:**
          ${{ github.event.inputs.release_body }}
          
          **Action Required:**
          - Review the release notes above
          - Update your workflows to use the new version: \`${{ github.repository }}@${{ steps.release-info.outputs.version }}\`
          - Test the updated workflows in a development environment first
          
          **Links:**
          - ðŸ“‹ [Release Notes](${{ steps.release-info.outputs.release_url }})
          - ðŸ“š [Documentation](https://github.com/${{ github.repository }}/blob/main/README.md)
          - ðŸ”§ [Migration Guide](https://github.com/${{ github.repository }}/blob/main/MIGRATION_SUMMARY.md)
          
          **Support:**
          If you encounter any issues, please create an issue in the [GitHub repository](https://github.com/${{ github.repository }}/issues)."
          
          # Save multiline description to output
          echo "description<<EOF" >> $GITHUB_OUTPUT
          echo "$DESCRIPTION" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Show task content (for debugging)
        run: |
          echo "=== TASK DETAILS ==="
          echo "Task Name: ðŸ¤– Asana <> Github Integration Update: ${{ steps.release-info.outputs.version }}"
          echo ""
          echo "=== TASK DESCRIPTION ==="
          echo "${{ steps.task-description.outputs.description }}"
          echo ""
          echo "=== ASANA PARAMETERS ==="
          echo "Project ID: 1209454604567606"
          echo "Section ID: 1209455675160384"

      # Android Team (Test)
      - name: Create test Asana task for Android team
        uses: ./
        with:
          asana-pat: ${{ secrets.ASANA_PAT_TEST }}
          asana-project: '1209454604567606'
          asana-section: '1209455675160384'
          asana-task-name: "ðŸ¤– Asana <> Github Integration Update: ${{ steps.release-info.outputs.version }}"
          asana-task-description: ${{ steps.task-description.outputs.description }}
          action: 'create-asana-task'
        continue-on-error: true

      - name: Test Summary
        run: |
          echo "âœ… Test release notification task created for version ${{ steps.release-info.outputs.version }}"
          echo "ðŸ“‹ Check Asana project 1209454604567606 for the created task"
          echo "ðŸ”— Release URL: ${{ steps.release-info.outputs.release_url }}" 